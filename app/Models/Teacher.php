<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\SoftDeletes;

class Teacher extends Model
{
    use HasFactory;
    use SoftDeletes;

    protected $fillable = [
        'account_id',
        'organization_id',
        'first_name',
        'middle_name',
        'last_name',
        'email',
        'phone',
        'subject',
        'qualification',
        'address',
        'city',
        'region',
        'country',
        'postal_code',
    ];

    public function resolveRouteBinding($value, $field = null)
    {
        return $this->where($field ?? 'id', $value)->withTrashed()->firstOrFail();
    }

    public function organization(): BelongsTo
    {
        return $this->belongsTo(Organization::class);
    }

    public function getNameAttribute()
    {
        return $this->first_name.' '.$this->middle_name.' '.$this->last_name;
    }

    public function scopeOrderByName($query)
    {
        $query->orderBy('last_name')->orderBy('first_name');
    }

    public function scopeFilter($query, array $filters)
    {
        $query->when($filters['search'] ?? null, function ($query, $search) {
            $query->where(function ($query) use ($search) {
                $query->where('first_name', 'like', '%'.$search.'%')
                    ->orWhere('last_name', 'like', '%'.$search.'%')
                    ->orWhere('email', 'like', '%'.$search.'%')
                    ->orWhere('subject', 'like', '%'.$search.'%')
                    ->orWhereHas('organization', function ($query) use ($search) {
                        $query->where('name', 'like', '%'.$search.'%');
                    });
            });
        })->when($filters['trashed'] ?? null, function ($query, $trashed) {
            if ($trashed === 'with') {
                $query->withTrashed();
            } elseif ($trashed === 'only') {
                $query->onlyTrashed();
            }
        });
    }

    public static function getSubjects(): array
    {
        return [
            'Українська мова',
            'Українська література',
            'Англійська мова',
            'Німецька мова',
            'Французька мова',
            'Польська мова',
            'Математика',
            'Алгебра',
            'Геометрія',
            'Інформатика',
            'Фізика',
            'Хімія',
            'Біологія',
            'Географія',
            'Історія України',
            'Всесвітня історія',
            'Правознавство',
            'Громадянська освіта',
            'Фізична культура',
            'Захист України',
            'Мистецтво',
            'Музичне мистецтво',
            'Образотворче мистецтво',
            'Трудове навчання',
            'Технології',
            'Астрономія',
            'Природознавство',
            'Основи здоров\'я',
            'Зарубіжна література',
            'Економіка',
        ];
    }

    public static function getQualifications(): array
    {
        return [
            'Спеціаліст',
            'Спеціаліст II категорії',
            'Спеціаліст I категорії',
            'Спеціаліст вищої категорії',
            'Вчитель-методист',
            'Старший вчитель',
            'Заслужений вчитель України',
        ];
    }

    public static function getRegions(): array
    {
        return [
            'Вінницька область',
            'Волинська область',
            'Дніпропетровська область',
            'Донецька область',
            'Житомирська область',
            'Закарпатська область',
            'Запорізька область',
            'Івано-Франківська область',
            'Київська область',
            'Кіровоградська область',
            'Луганська область',
            'Львівська область',
            'Миколаївська область',
            'Одеська область',
            'Полтавська область',
            'Рівненська область',
            'Сумська область',
            'Тернопільська область',
            'Харківська область',
            'Херсонська область',
            'Хмельницька область',
            'Черкаська область',
            'Чернівецька область',
            'Чернігівська область',
            'м. Київ',
        ];
    }

    public static function getCitiesByRegion(string $region): array
    {
        $cities = [
            'Вінницька область' => ['Бар', 'Вінниця', 'Гайсин', 'Жмеринка', 'Іллінці', 'Калинівка', 'Козятин', 'Ладижин', 'Липовець', 'Могилів-Подільський', 'Немирів', 'Погребище', 'Тульчин', 'Хмільник', 'Шаргород'],
            'Волинська область' => ['Володимир', 'Горохів', 'Камінь-Каширський', 'Ківерці', 'Ковель', 'Локачі', 'Луцьк', 'Любомль', 'Маневичі', 'Нововолинськ', 'Ратне', 'Рожище', 'Стара Вижівка', 'Турійськ'],
            'Дніпропетровська область' => ['Апостолове', 'Вільногірськ', 'Дніпро', 'Жовті Води', 'Кам\'янське', 'Кривий Ріг', 'Марганець', 'Нікополь', 'Новомосковськ', 'Павлоград', 'Першотравенськ', 'Підгородне', 'Покров', 'Синельникове', 'Тернівка'],
            'Донецька область' => ['Авдіївка', 'Бахмут', 'Волноваха', 'Добропілля', 'Дружківка', 'Костянтинівка', 'Краматорськ', 'Лиман', 'Маріуполь', 'Мирноград', 'Покровськ', 'Селидове', 'Слов\'янськ', 'Соледар', 'Торецьк'],
            'Житомирська область' => ['Андрушівка', 'Баранівка', 'Бердичів', 'Ємільчине', 'Житомир', 'Коростень', 'Коростишів', 'Малин', 'Народичі', 'Новоград-Волинський', 'Овруч', 'Олевськ', 'Радомишль', 'Романів', 'Чуднів'],
            'Закарпатська область' => ['Берегове', 'Великий Березний', 'Виноградів', 'Воловець', 'Іршава', 'Міжгір\'я', 'Мукачево', 'Перечин', 'Рахів', 'Свалява', 'Солотвино', 'Тячів', 'Ужгород', 'Хуст', 'Чоп'],
            'Запорізька область' => ['Бердянськ', 'Більмак', 'Василівка', 'Вільнянськ', 'Гуляйполе', 'Дніпрорудне', 'Енергодар', 'Запоріжжя', 'Кам\'янка-Дніпровська', 'Мелітополь', 'Молочанськ', 'Оріхів', 'Пологи', 'Приморськ', 'Токмак'],
            'Івано-Франківська область' => ['Болехів', 'Бурштин', 'Галич', 'Городенка', 'Долина', 'Івано-Франківськ', 'Калуш', 'Коломия', 'Косів', 'Надвірна', 'Рогатин', 'Снятин', 'Тисмениця', 'Тлумач', 'Яремче'],
            'Київська область' => ['Березань', 'Біла Церква', 'Богуслав', 'Бориспіль', 'Боярка', 'Бровари', 'Буча', 'Васильків', 'Вишгород', 'Вишневе', 'Ірпінь', 'Обухів', 'Переяслав', 'Ржищів', 'Сквира', 'Славутич', 'Тараща', 'Українка', 'Фастів', 'Яготин'],
            'Кіровоградська область' => ['Благовіщенське', 'Бобринець', 'Гайворон', 'Долинська', 'Знам\'янка', 'Кропивницький', 'Мала Виска', 'Новоархангельськ', 'Новомиргород', 'Новоукраїнка', 'Олександрія', 'Петрове', 'Помічна', 'Світловодськ', 'Ульяновка'],
            'Луганська область' => ['Біловодськ', 'Білокуракине', 'Кремінна', 'Лисичанськ', 'Марківка', 'Новоайдар', 'Новопсков', 'Попасна', 'Рубіжне', 'Сватове', 'Сєвєродонецьк', 'Станиця Луганська', 'Старобільськ', 'Троїцьке', 'Щастя'],
            'Львівська область' => ['Борислав', 'Броди', 'Буськ', 'Городок', 'Дрогобич', 'Жидачів', 'Жовква', 'Золочів', 'Львів', 'Моршин', 'Новий Розділ', 'Новояворівськ', 'Перемишляни', 'Пустомити', 'Радехів', 'Самбір', 'Сокаль', 'Стрий', 'Трускавець', 'Червоноград'],
            'Миколаївська область' => ['Арбузинка', 'Баштанка', 'Березнегувате', 'Веселинове', 'Вознесенськ', 'Врадіївка', 'Доманівка', 'Єланець', 'Миколаїв', 'Нова Одеса', 'Новий Буг', 'Очаків', 'Первомайськ', 'Снігурівка', 'Южноукраїнськ'],
            'Одеська область' => ['Ананьїв', 'Арциз', 'Балта', 'Березівка', 'Білгород-Дністровський', 'Біляївка', 'Болград', 'Вилкове', 'Доброслав', 'Ізмаїл', 'Кілія', 'Кодима', 'Одеса', 'Подільськ', 'Рені', 'Роздільна', 'Татарбунари', 'Теплодар', 'Чорноморськ', 'Южне'],
            'Полтавська область' => ['Гадяч', 'Глобине', 'Горішні Плавні', 'Гребінка', 'Диканька', 'Зіньків', 'Карлівка', 'Кобеляки', 'Котельва', 'Кременчук', 'Лохвиця', 'Лубни', 'Машівка', 'Миргород', 'Пирятин', 'Полтава', 'Решетилівка', 'Хорол', 'Чутове', 'Шишаки'],
            'Рівненська область' => ['Березне', 'Вараш', 'Володимирець', 'Гоща', 'Демидівка', 'Дубно', 'Дубровиця', 'Зарічне', 'Здолбунів', 'Квасилів', 'Клесів', 'Корець', 'Костопіль', 'Млинів', 'Острог', 'Радивилів', 'Рівне', 'Рокитне', 'Сарни'],
            'Сумська область' => ['Білопілля', 'Буринь', 'Ворожба', 'Глухів', 'Дружба', 'Конотоп', 'Краснопілля', 'Кролевець', 'Лебедин', 'Липова Долина', 'Недригайлів', 'Охтирка', 'Путивль', 'Ромни', 'Середина-Буда', 'Суми', 'Тростянець', 'Шостка'],
            'Тернопільська область' => ['Бережани', 'Борщів', 'Бучач', 'Заліщики', 'Збараж', 'Зборів', 'Копичинці', 'Кременець', 'Ланівці', 'Монастириська', 'Підгайці', 'Почаїв', 'Скалат', 'Теребовля', 'Тернопіль', 'Хоростків', 'Чортків', 'Шумськ'],
            'Харківська область' => ['Балаклія', 'Барвінкове', 'Богодухів', 'Валки', 'Вовчанськ', 'Дворічна', 'Дергачі', 'Зміїв', 'Ізюм', 'Красноград', 'Краснокутськ', 'Куп\'янськ', 'Лозова', 'Люботин', 'Мерефа', 'Первомайський', 'Південне', 'Пісочин', 'Солоницівка', 'Харків', 'Чугуїв'],
            'Херсонська область' => ['Антонівка', 'Берислав', 'Білозерка', 'Великолепетиське', 'Верхній Рогачик', 'Генічеськ', 'Гола Пристань', 'Горностаївка', 'Високопілля', 'Каховка', 'Нова Каховка', 'Нововоронцовка', 'Новотроїцьке', 'Олешки', 'Скадовськ', 'Таврійськ', 'Херсон', 'Чаплинка'],
            'Хмельницька область' => ['Білогір\'я', 'Віньківці', 'Волочиськ', 'Городок', 'Деражня', 'Дунаївці', 'Ізяслав', 'Кам\'янець-Подільський', 'Красилів', 'Летичів', 'Нетішин', 'Нова Ушиця', 'Полонне', 'Славута', 'Стара Синява', 'Старокостянтинів', 'Теофіполь', 'Хмельницький', 'Шепетівка'],
            'Черкаська область' => ['Ватутіне', 'Городище', 'Драбів', 'Жашків', 'Звенигородка', 'Золотоноша', 'Кам\'янка', 'Канів', 'Катеринопіль', 'Корсунь-Шевченківський', 'Лисянка', 'Маньківка', 'Монастирище', 'Сміла', 'Тальне', 'Умань', 'Черкаси', 'Чигирин', 'Чорнобай', 'Шпола', 'Христинівка'],
            'Чернівецька область' => ['Берегомет', 'Вашківці', 'Вижниця', 'Герца', 'Глибока', 'Заставна', 'Кельменці', 'Кіцмань', 'Красноїльськ', 'Лужани', 'Магала', 'Недобоївці', 'Новодністровськ', 'Новоселиця', 'Путила', 'Сокиряни', 'Сторожинець', 'Хотин', 'Чернівці'],
            'Чернігівська область' => ['Бахмач', 'Березна', 'Бобровиця', 'Борзна', 'Варва', 'Городня', 'Ічня', 'Короп', 'Корюківка', 'Куликівка', 'Мена', 'Ніжин', 'Новгород-Сіверський', 'Носівка', 'Прилуки', 'Ріпки', 'Семенівка', 'Сновськ', 'Сосниця', 'Талалаївка', 'Чернігів'],
            'м. Київ' => ['Київ'],
        ];

        return $cities[$region] ?? [];
    }
} 