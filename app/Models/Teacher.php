<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\SoftDeletes;

class Teacher extends Model
{
    use HasFactory;
    use SoftDeletes;

    protected $fillable = [
        'account_id',
        'organization_id',
        'first_name',
        'middle_name',
        'last_name',
        'email',
        'phone',
        'subject',
        'qualification',
        'address',
        'city',
        'region',
        'country',
        'postal_code',
    ];

    public function resolveRouteBinding($value, $field = null)
    {
        return $this->where($field ?? 'id', $value)->withTrashed()->firstOrFail();
    }

    public function organization(): BelongsTo
    {
        return $this->belongsTo(Organization::class);
    }

    public function getNameAttribute()
    {
        return $this->first_name.' '.$this->middle_name.' '.$this->last_name;
    }

    public function scopeOrderByName($query)
    {
        $query->orderBy('last_name')->orderBy('first_name');
    }

    public function scopeFilter($query, array $filters)
    {
        $query->when($filters['search'] ?? null, function ($query, $search) {
            $query->where(function ($query) use ($search) {
                $query->where('first_name', 'like', '%'.$search.'%')
                    ->orWhere('last_name', 'like', '%'.$search.'%')
                    ->orWhere('email', 'like', '%'.$search.'%')
                    ->orWhere('subject', 'like', '%'.$search.'%')
                    ->orWhereHas('organization', function ($query) use ($search) {
                        $query->where('name', 'like', '%'.$search.'%');
                    });
            });
        })->when($filters['trashed'] ?? null, function ($query, $trashed) {
            if ($trashed === 'with') {
                $query->withTrashed();
            } elseif ($trashed === 'only') {
                $query->onlyTrashed();
            }
        });
    }

    public static function getSubjects(): array
    {
        return [
            'Українська мова',
            'Українська література',
            'Англійська мова',
            'Німецька мова',
            'Французька мова',
            'Польська мова',
            'Математика',
            'Алгебра',
            'Геометрія',
            'Інформатика',
            'Фізика',
            'Хімія',
            'Біологія',
            'Географія',
            'Історія України',
            'Всесвітня історія',
            'Правознавство',
            'Громадянська освіта',
            'Фізична культура',
            'Захист України',
            'Мистецтво',
            'Музичне мистецтво',
            'Образотворче мистецтво',
            'Трудове навчання',
            'Технології',
            'Астрономія',
            'Природознавство',
            'Основи здоров\'я',
            'Зарубіжна література',
            'Економіка',
        ];
    }

    public static function getQualifications(): array
    {
        return [
            'Спеціаліст',
            'Спеціаліст II категорії',
            'Спеціаліст I категорії',
            'Спеціаліст вищої категорії',
            'Вчитель-методист',
            'Старший вчитель',
            'Заслужений вчитель України',
        ];
    }

    public static function getRegions(): array
    {
        return [
            'Вінницька область',
            'Волинська область',
            'Дніпропетровська область',
            'Донецька область',
            'Житомирська область',
            'Закарпатська область',
            'Запорізька область',
            'Івано-Франківська область',
            'Київська область',
            'Кіровоградська область',
            'Луганська область',
            'Львівська область',
            'Миколаївська область',
            'Одеська область',
            'Полтавська область',
            'Рівненська область',
            'Сумська область',
            'Тернопільська область',
            'Харківська область',
            'Херсонська область',
            'Хмельницька область',
            'Черкаська область',
            'Чернівецька область',
            'Чернігівська область',
            'м. Київ',
        ];
    }

    public static function getCitiesByRegion(string $region): array
    {
        $cities = [
            'Вінницька область' => ['Вінниця', 'Жмеринка', 'Могилів-Подільський', 'Хмільник', 'Козятин', 'Ладижин', 'Бар'],
            'Волинська область' => ['Луцьк', 'Ковель', 'Нововолинськ', 'Володимир', 'Луцьк', 'Ківерці', 'Рожище'],
            'Дніпропетровська область' => ['Дніпро', 'Кривий Ріг', 'Кам\'янське', 'Нікополь', 'Павлоград', 'Новомосковськ', 'Марганець'],
            'Донецька область' => ['Краматорськ', 'Слов\'янськ', 'Маріуполь', 'Бахмут', 'Дружківка', 'Костянтинівка', 'Покровськ'],
            'Житомирська область' => ['Житомир', 'Бердичів', 'Коростень', 'Новоград-Волинський', 'Малин', 'Радомишль', 'Овруч'],
            'Закарпатська область' => ['Ужгород', 'Мукачево', 'Хуст', 'Виноградів', 'Берегове', 'Свалява', 'Іршава'],
            'Запорізька область' => ['Запоріжжя', 'Мелітополь', 'Бердянськ', 'Енергодар', 'Токмак', 'Пологи', 'Вільнянськ'],
            'Івано-Франківська область' => ['Івано-Франківськ', 'Коломия', 'Калуш', 'Надвірна', 'Долина', 'Яремче', 'Галич'],
            'Київська область' => ['Біла Церква', 'Бровари', 'Бориспіль', 'Ірпінь', 'Фастів', 'Обухів', 'Васильків'],
            'Кіровоградська область' => ['Кропивницький', 'Олександрія', 'Світловодськ', 'Знам\'янка', 'Долинська', 'Гайворон', 'Новоукраїнка'],
            'Луганська область' => ['Сєвєродонецьк', 'Лисичанськ', 'Рубіжне', 'Старобільськ', 'Сватове', 'Кремінна', 'Щастя'],
            'Львівська область' => ['Львів', 'Дрогобич', 'Червоноград', 'Стрий', 'Самбір', 'Трускавець', 'Борислав'],
            'Миколаївська область' => ['Миколаїв', 'Первомайськ', 'Южноукраїнськ', 'Вознесенськ', 'Очаків', 'Нова Одеса', 'Баштанка'],
            'Одеська область' => ['Одеса', 'Ізмаїл', 'Чорноморськ', 'Білгород-Дністровський', 'Южне', 'Подільськ', 'Теплодар'],
            'Полтавська область' => ['Полтава', 'Кременчук', 'Горішні Плавні', 'Лубни', 'Миргород', 'Гадяч', 'Пирятин'],
            'Рівненська область' => ['Рівне', 'Дубно', 'Вараш', 'Костопіль', 'Сарни', 'Здолбунів', 'Радивилів'],
            'Сумська область' => ['Суми', 'Конотоп', 'Шостка', 'Ромни', 'Охтирка', 'Глухів', 'Лебедин'],
            'Тернопільська область' => ['Тернопіль', 'Чортків', 'Кременець', 'Бережани', 'Збараж', 'Теребовля', 'Бучач'],
            'Харківська область' => ['Харків', 'Лозова', 'Ізюм', 'Чугуїв', 'Первомайський', 'Куп\'янськ', 'Балаклія'],
            'Херсонська область' => ['Херсон', 'Нова Каховка', 'Каховка', 'Гола Пристань', 'Скадовськ', 'Олешки', 'Генічеськ'],
            'Хмельницька область' => ['Хмельницький', 'Кам\'янець-Подільський', 'Шепетівка', 'Нетішин', 'Славута', 'Старокостянтинів', 'Дунаївці'],
            'Черкаська область' => ['Черкаси', 'Умань', 'Сміла', 'Золотоноша', 'Канів', 'Ватутіне', 'Звенигородка'],
            'Чернівецька область' => ['Чернівці', 'Новодністровськ', 'Хотин', 'Кіцмань', 'Заставна', 'Вижниця', 'Новоселиця'],
            'Чернігівська область' => ['Чернігів', 'Ніжин', 'Прилуки', 'Новгород-Сіверський', 'Бахмач', 'Корюківка', 'Мена'],
            'м. Київ' => ['Київ'],
        ];

        return $cities[$region] ?? [];
    }
} 